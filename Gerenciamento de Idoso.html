<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Idosos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #4facfe;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4facfe;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9800 100%);
        }

        .elderly-list {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .elderly-item {
            border-bottom: 1px solid #f0f0f0;
            padding: 20px;
            transition: background-color 0.2s ease;
        }

        .elderly-item:hover {
            background-color: #f8f9ff;
        }

        .elderly-item:last-child {
            border-bottom: none;
        }

        .elderly-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .elderly-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .elderly-cpf {
            color: #666;
            font-size: 0.9rem;
        }

        .elderly-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .detail-group {
            background: #f8f9ff;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #333;
        }

        .elderly-actions {
            margin-top: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .status-cadeirante {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-acamado {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-deficiencia {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .health-conditions {
            margin-top: 10px;
        }

        .condition-tag {
            display: inline-block;
            background: #ffebee;
            color: #c62828;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-right: 5px;
            margin-bottom: 3px;
        }

        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .dependency-tags {
            margin-top: 10px;
        }

        .dependency-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-right: 5px;
            margin-bottom: 3px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .elderly-details {
                grid-template-columns: 1fr;
            }

            .elderly-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
            background: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="auto-save-indicator" id="autoSaveIndicator">
        ‚úì Dados salvos automaticamente
    </div>

    <div class="container">
        <div class="header">
            <h1>Sistema de Gerenciamento de Idosos</h1>
            <p>Cadastro e acompanhamento de idosos com grau de depend√™ncia</p>
        </div>

        <div class="content">
            <div class="form-section">
                <h2 id="formTitle">Cadastrar Novo Idoso</h2>
                <form id="elderlyForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Nome Completo *</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="cpf">CPF *</label>
                            <input type="text" id="cpf" required maxlength="14" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label for="age">Idade</label>
                            <input type="number" id="age" min="40" max="120">
                        </div>
                        <div class="form-group">
                            <label for="dependencyGrade">Grau de Depend√™ncia *</label>
                            <select id="dependencyGrade" required>
                                <option value="">Selecione o grau</option>
                                <option value="I">Grau I - Depend√™ncia Leve</option>
                                <option value="II">Grau II - Depend√™ncia Moderada</option>
                                <option value="III">Grau III - Depend√™ncia Severa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Especifica√ß√µes Adicionais (Opcional)</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="cadeirante">
                                <label for="cadeirante">Cadeirante</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="acamado">
                                <label for="acamado">Acamado</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="deficiente">
                                <label for="deficiente">Deficiente</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Quadro de Sa√∫de</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="transtornoMental">
                                <label for="transtornoMental">Transtorno Mental</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="demencia">
                                <label for="demencia">Dem√™ncia</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="alzheimer">
                                <label for="alzheimer">Alzheimer</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hipertensao">
                                <label for="hipertensao">Hipertens√£o</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="diabetes">
                                <label for="diabetes">Diabetes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cardiopatia">
                                <label for="cardiopatia">Cardiopatia</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="avc">
                                <label for="avc">AVC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="parkinson">
                                <label for="parkinson">Parkinson</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customHealthConditions">Condi√ß√µes de Sa√∫de Adicionais</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="newHealthCondition" placeholder="Digite uma nova condi√ß√£o de sa√∫de"
                                style="flex: 1;">
                            <button type="button" class="btn" onclick="addHealthCondition()">Adicionar</button>
                        </div>
                        <div id="customHealthConditionsList" style="display: flex; flex-wrap: wrap; gap: 5px;">
                        </div>
                    </div>

                    <div>
                        <button type="submit" class="btn btn-success" id="submitBtn">Cadastrar Idoso</button>
                        <button type="button" class="btn btn-warning" id="cancelEdit" style="display: none;"
                            onclick="cancelEdit()">Cancelar Edi√ß√£o</button>
                    </div>
                </form>
            </div>

            <div class="form-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Lista de Idosos Cadastrados (<span id="totalCount">0</span>)</h2>
                    <button class="btn" onclick="generatePDF()">üìÑ Gerar Relat√≥rio PDF</button>
                </div>

                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="üîç Buscar por nome ou CPF..."
                        onkeyup="searchElderly()">
                </div>

                <div id="elderlyList" class="elderly-list">
                    <div class="empty-state">
                        <h3>Nenhum idoso cadastrado</h3>
                        <p>Utilize o formul√°rio acima para cadastrar o primeiro idoso</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let elderlyData = [];
        let editingIndex = -1;
        let customHealthConditions = [];

        // Carregar dados ao iniciar
        window.onload = function () {
            loadData();
            renderElderlyList();
        };

        // Formata√ß√£o de CPF
        document.getElementById('cpf').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        // Permitir adicionar condi√ß√£o de sa√∫de com Enter
        document.getElementById('newHealthCondition').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addHealthCondition();
            }
        });

        // Submiss√£o do formul√°rio
        document.getElementById('elderlyForm').addEventListener('submit', function (e) {
            e.preventDefault();

            if (editingIndex >= 0) {
                updateElderly();
            } else {
                addElderly();
            }
        });

        function addHealthCondition() {
            const input = document.getElementById('newHealthCondition');
            const condition = input.value.trim();
            if (condition && !customHealthConditions.includes(condition)) {
                customHealthConditions.push(condition);
                renderCustomHealthConditions();
                input.value = '';
            }
        }

        function renderCustomHealthConditions() {
            const container = document.getElementById('customHealthConditionsList');
            container.innerHTML = '';
            customHealthConditions.forEach((cond, index) => {
                const tag = document.createElement('span');
                tag.className = 'condition-tag';
                tag.textContent = cond;
                tag.style.cursor = "pointer";
                tag.title = "Clique para remover";
                tag.onclick = () => {
                    customHealthConditions.splice(index, 1);
                    renderCustomHealthConditions();
                };
                container.appendChild(tag);
            });
        }

        function addElderly() {
            const formData = getFormData();
            if (validateCPF(formData.cpf)) {
                elderlyData.push(formData);
                saveData();
                renderElderlyList();
                clearForm();
                showAutoSaveIndicator();
            }
        }

        function updateElderly() {
            const formData = getFormData();
            if (validateCPF(formData.cpf, editingIndex)) {
                elderlyData[editingIndex] = formData;
                saveData();
                renderElderlyList();
                clearForm();
                cancelEdit();
                showAutoSaveIndicator();
            }
        }

        function getFormData() {
            return {
                id: editingIndex >= 0 ? elderlyData[editingIndex].id : Date.now(),
                name: document.getElementById('name').value.trim(),
                cpf: document.getElementById('cpf').value.trim(),
                age: document.getElementById('age').value,
                dependencyGrade: document.getElementById('dependencyGrade').value,
                dependencies: {
                    cadeirante: document.getElementById('cadeirante').checked,
                    acamado: document.getElementById('acamado').checked,
                    deficiente: document.getElementById('deficiente').checked
                },
                healthConditions: {
                    demencia: document.getElementById('demencia').checked,
                    alzheimer: document.getElementById('alzheimer').checked,
                    hipertensao: document.getElementById('hipertensao').checked,
                    diabetes: document.getElementById('diabetes').checked,
                    transtornoMental: document.getElementById('transtornoMental').checked,
                    cardiopatia: document.getElementById('cardiopatia').checked,
                    avc: document.getElementById('avc').checked,
                    parkinson: document.getElementById('parkinson').checked
                },
                customHealthConditions: [...customHealthConditions],
                createdAt: editingIndex >= 0 ? elderlyData[editingIndex].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
        }

        function validateCPF(cpf, excludeIndex = -1) {
            const existingIndex = elderlyData.findIndex(elderly => elderly.cpf === cpf);
            if (existingIndex >= 0 && existingIndex !== excludeIndex) {
                alert('CPF j√° cadastrado!');
                return false;
            }
            return true;
        }

        function clearForm() {
            document.getElementById('elderlyForm').reset();
            customHealthConditions = [];
            renderCustomHealthConditions();
        }

        function saveData() {
            try {
                const data = JSON.stringify(elderlyData);
                window.elderlyStorageData = data; // Armazena em mem√≥ria
                console.log('Dados salvos em mem√≥ria');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        function loadData() {
            try {
                if (window.elderlyStorageData) {
                    elderlyData = JSON.parse(window.elderlyStorageData);
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                elderlyData = [];
            }
        }

        function renderElderlyList() {
            const list = document.getElementById('elderlyList');
            const totalCount = document.getElementById('totalCount');

            totalCount.textContent = elderlyData.length;

            if (elderlyData.length === 0) {
                list.innerHTML = `
                <div class="empty-state">
                    <h3>Nenhum idoso cadastrado</h3>
                    <p>Utilize o formul√°rio acima para cadastrar o primeiro idoso</p>
                </div>
            `;
                return;
            }
            list.innerHTML = elderlyData.map((elderly, index) => createElderlyCard(elderly, index)).join('');
        }

        function createElderlyCard(elderly, index) {
            // Criar tags de depend√™ncias
            const dependencyTags = [];
            if (elderly.dependencies.cadeirante) dependencyTags.push('<span class="status-badge status-cadeirante">Cadeirante</span>');
            if (elderly.dependencies.acamado) dependencyTags.push('<span class="status-badge status-acamado">Acamado</span>');
            if (elderly.dependencies.deficiente) dependencyTags.push('<span class="status-badge status-deficiencia">Deficiente</span>');

            // Criar tags de condi√ß√µes de sa√∫de
            const healthTags = [];
            const healthLabels = {
                demencia: 'Dem√™ncia',
                alzheimer: 'Alzheimer',
                hipertensao: 'Hipertens√£o',
                diabetes: 'Diabetes',
                transtornoMental: 'Transtorno Mental',
                cardiopatia: 'Cardiopatia',
                avc: 'AVC',
                parkinson: 'Parkinson'
            };

            Object.keys(elderly.healthConditions).forEach(key => {
                if (elderly.healthConditions[key]) {
                    healthTags.push(`<span class="condition-tag">${healthLabels[key] || key}</span>`);
                }
            });

            // Adicionar condi√ß√µes customizadas
            if (elderly.customHealthConditions) {
                elderly.customHealthConditions.forEach(cond => {
                    healthTags.push(`<span class="condition-tag">${cond}</span>`);
                });
            }

            return `
            <div class="elderly-item">
                <div class="elderly-header">
                    <div>
                        <div class="elderly-name">${elderly.name}</div>
                        <div class="elderly-cpf">CPF: ${elderly.cpf}</div>
                    </div>
                </div>
                
                <div class="elderly-details">
                    ${elderly.age ? `<div class="detail-group"><div class="detail-label">Idade</div><div class="detail-value">${elderly.age} anos</div></div>` : ''}
                    ${elderly.dependencyGrade ? `<div class="detail-group"><div class="detail-label">Grau de Depend√™ncia</div><div class="detail-value">${elderly.dependencyGrade}</div></div>` : ''}
                </div>

                ${dependencyTags.length > 0 ? `<div class="dependency-tags">${dependencyTags.join('')}</div>` : ''}

                ${healthTags.length > 0 ? `<div class="health-conditions"><div class="detail-label">Condi√ß√µes de Sa√∫de</div>${healthTags.join('')}</div>` : ''}
                
                <div class="elderly-actions">
                    <button class="btn" onclick="editElderly(${index})">‚úèÔ∏è Editar</button>
                    <button class="btn btn-danger" onclick="deleteElderly(${index})">üóëÔ∏è Excluir</button>
                </div>
            </div>
        `;
        }

        function editElderly(index) {
            const elderly = elderlyData[index];
            editingIndex = index;

            // Preencher o formul√°rio com os dados
            document.getElementById('name').value = elderly.name;
            document.getElementById('cpf').value = elderly.cpf;
            document.getElementById('age').value = elderly.age || '';
            document.getElementById('dependencyGrade').value = elderly.dependencyGrade || '';

            // Preencher checkboxes de depend√™ncias
            document.getElementById('cadeirante').checked = elderly.dependencies.cadeirante || false;
            document.getElementById('acamado').checked = elderly.dependencies.acamado || false;
            document.getElementById('deficiente').checked = elderly.dependencies.deficiente || false;

            // Preencher checkboxes de condi√ß√µes de sa√∫de
            document.getElementById('demencia').checked = elderly.healthConditions.demencia || false;
            document.getElementById('alzheimer').checked = elderly.healthConditions.alzheimer || false;
            document.getElementById('hipertensao').checked = elderly.healthConditions.hipertensao || false;
            document.getElementById('diabetes').checked = elderly.healthConditions.diabetes || false;
            document.getElementById('transtornoMental').checked = elderly.healthConditions.transtornoMental || false;
            document.getElementById('cardiopatia').checked = elderly.healthConditions.cardiopatia || false;
            document.getElementById('avc').checked = elderly.healthConditions.avc || false;
            document.getElementById('parkinson').checked = elderly.healthConditions.parkinson || false;

            // Preencher condi√ß√µes customizadas
            customHealthConditions = elderly.customHealthConditions ? [...elderly.customHealthConditions] : [];
            renderCustomHealthConditions();

            // Alterar interface para modo de edi√ß√£o
            document.getElementById('formTitle').textContent = 'Editar Idoso';
            document.getElementById('submitBtn').textContent = 'Atualizar Dados';
            document.getElementById('submitBtn').className = 'btn btn-warning';
            document.getElementById('cancelEdit').style.display = 'inline-block';

            // Rolar para o formul√°rio
            document.getElementById('elderlyForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingIndex = -1;
            clearForm();

            // Restaurar interface normal
            document.getElementById('formTitle').textContent = 'Cadastrar Novo Idoso';
            document.getElementById('submitBtn').textContent = 'Cadastrar Idoso';
            document.getElementById('submitBtn').className = 'btn btn-success';
            document.getElementById('cancelEdit').style.display = 'none';
        }

        function deleteElderly(index) {
            const elderly = elderlyData[index];

            if (confirm(`Tem certeza que deseja excluir o cadastro de "${elderly.name}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                elderlyData.splice(index, 1);
                saveData();
                renderElderlyList();
                showAutoSaveIndicator();

                // Se estava editando este registro, cancelar a edi√ß√£o
                if (editingIndex === index) {
                    cancelEdit();
                } else if (editingIndex > index) {
                    // Ajustar o √≠ndice se estava editando um registro posterior
                    editingIndex--;
                }
            }
        }

        function searchElderly() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = elderlyData.filter(elderly =>
                elderly.name.toLowerCase().includes(searchTerm) ||
                elderly.cpf.includes(searchTerm)
            );

            const list = document.getElementById('elderlyList');

            if (filteredData.length === 0) {
                if (searchTerm === '') {
                    renderElderlyList();
                } else {
                    list.innerHTML = `
                        <div class="empty-state">
                            <h3>Nenhum resultado encontrado</h3>
                            <p>Tente buscar por outro nome ou CPF</p>
                        </div>
                    `;
                }
                return;
            }

            list.innerHTML = filteredData.map((elderly, originalIndex) => {
                // Encontrar o √≠ndice original no array completo
                const realIndex = elderlyData.findIndex(e => e.id === elderly.id);
                return createElderlyCard(elderly, realIndex);
            }).join('');
        }

        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        function generatePDF() {
            if (elderlyData.length === 0) {
                alert('N√£o h√° dados para gerar o relat√≥rio.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Configura√ß√µes iniciais
            let yPosition = 20;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            const lineHeight = 6;

            // T√≠tulo
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('RELAT√ìRIO DE IDOSOS CADASTRADOS', pageWidth / 2, yPosition, { align: 'center' });

            yPosition += 10;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Data de Gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, pageWidth / 2, yPosition, { align: 'center' });
            doc.text(`Total de Registros: ${elderlyData.length}`, pageWidth / 2, yPosition + 5, { align: 'center' });

            yPosition += 20;

            elderlyData.forEach((elderly, index) => {
                // Verifica se precisa de nova p√°gina
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }

                // Cabe√ßalho do idoso
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`${index + 1}. ${elderly.name}`, margin, yPosition);
                yPosition += lineHeight;

                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`CPF: ${elderly.cpf}`, margin + 5, yPosition);
                yPosition += lineHeight;

                if (elderly.age) {
                    doc.text(`Idade: ${elderly.age} anos`, margin + 5, yPosition);
                    yPosition += lineHeight;
                }

                if (elderly.dependencyGrade) {
                    doc.text(`Grau de Depend√™ncia: ${elderly.dependencyGrade}`, margin + 5, yPosition);
                    yPosition += lineHeight;
                }

                // Depend√™ncias espec√≠ficas
                const dependencies = [];
                if (elderly.dependencies.cadeirante) dependencies.push('Cadeirante');
                if (elderly.dependencies.acamado) dependencies.push('Acamado');
                if (elderly.dependencies.deficiente) dependencies.push('Deficiente');

                if (dependencies.length > 0) {
                    doc.text(`Especifica√ß√µes: ${dependencies.join(', ')}`, margin + 5, yPosition);
                    yPosition += lineHeight;
                }

                // Condi√ß√µes de sa√∫de
                const conditions = [];
                const healthLabels = {
                    demencia: 'Dem√™ncia',
                    alzheimer: 'Alzheimer',
                    hipertensao: 'Hipertens√£o',
                    diabetes: 'Diabetes',
                    transtornoMental: 'Transtorno Mental',
                    cardiopatia: 'Cardiopatia',
                    avc: 'AVC',
                    parkinson: 'Parkinson'
                };

                Object.keys(elderly.healthConditions).forEach(key => {
                    if (elderly.healthConditions[key]) {
                        conditions.push(healthLabels[key] || key);
                    }
                });

                if (elderly.customHealthConditions && elderly.customHealthConditions.length > 0) {
                    conditions.push(...elderly.customHealthConditions);
                }

                if (conditions.length > 0) {
                    const conditionsText = `Condi√ß√µes de Sa√∫de: ${conditions.join(', ')}`;
                    const lines = doc.splitTextToSize(conditionsText, pageWidth - 2 * margin - 5);
                    lines.forEach(line => {
                        doc.text(line, margin + 5, yPosition);
                        yPosition += lineHeight;
                    });
                }

                yPosition += 5; // Espa√ßo entre registros
            });

            // Rodap√©
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`P√°gina ${i} de ${pageCount}`, pageWidth / 2, doc.internal.pageSize.height - 10, { align: 'center' });
            }

            // Salvar o PDF
            const fileName = `relatorio_idosos_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.pdf`;
            doc.save(fileName);
        }
    </script>
</body>

</html>