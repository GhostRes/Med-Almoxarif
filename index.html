<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Clientes</title>
</head>
<body>

<h2>Login</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>

<hr>

<div id="app"></div>

<script type="module">
  // üî• IMPORTA√á√ïES FIREBASE (CDN)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, doc, getDoc } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîë CONFIGURA√á√ÉO DO SEU FIREBASE
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_PROJETO.firebaseapp.com",
    projectId: "SEU_PROJETO",
    storageBucket: "SEU_PROJETO.appspot.com",
    messagingSenderId: "SEU_ID",
    appId: "SEU_APP_ID"
  };

  // üöÄ INICIALIZA√á√ÉO
  const appFirebase = initializeApp(firebaseConfig);
  const auth = getAuth(appFirebase);
  const db = getFirestore(appFirebase);

  const appDiv = document.getElementById("app");

  // üîê LOGIN
  window.login = async function () {
    await signInWithEmailAndPassword(
      auth,
      email.value,
      senha.value
    );
  };

  // üë§ VERIFICA USU√ÅRIO LOGADO
  onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    const ref = doc(db, "usuarios", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      appDiv.innerHTML = "<p>Usu√°rio sem permiss√£o.</p>";
      return;
    }

    const tipo = snap.data().tipo;

    if (tipo === "admin") {
      telaAdmin();
    } else {
      telaUsuario();
    }
  });

  // üë§ TELA USU√ÅRIO COMUM
  function telaUsuario() {
    appDiv.innerHTML = `
      <h3>Cadastro de Cliente</h3>
      <input id="nome" placeholder="Nome do cliente"><br><br>
      <input id="telefone" placeholder="Telefone"><br><br>
      <button onclick="salvarCliente()">Salvar</button>
    `;
  }

  // üëë TELA ADMIN
  async function telaAdmin() {
    appDiv.innerHTML = `
      <h3>Clientes Cadastrados</h3>
      <ul id="lista"></ul>
    `;

    const lista = document.getElementById("lista");
    const clientes = await getDocs(collection(db, "clientes"));

    clientes.forEach(doc => {
      const c = doc.data();
      lista.innerHTML += `<li>${c.nome} - ${c.telefone}</li>`;
    });
  }

  // üíæ SALVAR CLIENTE
  window.salvarCliente = async function () {
    await addDoc(collection(db, "clientes"), {
      nome: nome.value,
      telefone: telefone.value,
      data: new Date()
    });

    alert("Cliente cadastrado com sucesso!");
    nome.value = "";
    telefone.value = "";
  };
</script>

</body>
</html>
